
var admin = require("firebase-admin");
// Install the module before run de script
// from the root directory run:
// npm install --save firebase-admin

// command to execute de script:
// node .\example\server\pushFCM-Firebase-admin.js 

// Create aplication case you don't had yet.
// Documentation of firebase to help:
// https://console.firebase.google.com/u/0/project/<NAMEOFPROJECTCREATED>/settings/serviceaccounts/adminsdk
// Read configs downloaded from google at project config.
// https://console.firebase.google.com/u/0/project/<NAMEOFPROJECTCREATED>/settings/general/<PLATFORM>:<NAMEOFPACKAGE>

var serviceAccount = require("./google-services.json");

// Receiver device token
const deviceToken = '<Token generated by your test device>'; 

var defaultAppConfig = {
  credential: admin.credential.cert(serviceAccount),
}

admin.initializeApp(defaultAppConfig);
console.log(admin.app().name);


// Documentation of firebase to help:
// https://firebase.google.com/docs/cloud-messaging/send-message
var defaultMessenger = admin.messaging();
console.log(defaultMessenger);


var message = {
  data: {
    title: 'NodeJS says:',
    body: 'Push with NodeJS works well!',
  },
  token: deviceToken
};

defaultMessenger.send(message)
  .then((response) => {
    // Response is a message ID string.
    console.log('Successfully sent message:', response);
  })
  .catch((error) => {
    console.log('Error sending message:', error);
  });
